<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Auth System</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body class="admin-theme">
    <!-- Arka Plan Åekilleri -->
    <div class="bg-shapes">
        <div class="bg-shape bg-shape-1"></div>
        <div class="bg-shape bg-shape-2"></div>
        <div class="bg-shape bg-shape-3"></div>
    </div>

    <!-- Admin Container -->
    <div class="admin-container">
        <div class="admin-panel">
            <!-- Panel Header -->
            <div class="admin-panel-header">
                <h1 class="admin-panel-title">
                    <span>ğŸ›¡ï¸</span>
                    Admin Panel
                </h1>

                <div class="admin-stats">
                    <div class="admin-stat">
                        <div class="admin-stat-value" id="userCount">0</div>
                        <div class="admin-stat-label">Toplam KullanÄ±cÄ±</div>
                    </div>
                </div>

                <button class="btn btn-outline" id="logoutBtn">
                    ğŸšª Ã‡Ä±kÄ±ÅŸ Yap
                </button>
            </div>

            <!-- Panel Body -->
            <div class="admin-panel-body">
                <!-- Alert Container -->
                <div id="alertContainer"></div>

                <!-- Users Table -->
                <div class="table-container">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>KullanÄ±cÄ± AdÄ±</th>
                                <th>Email</th>
                                <th>Åifre</th>
                                <th>KayÄ±t Tarihi</th>
                                <th>Ä°ÅŸlem</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-state-icon">ğŸ‘¥</div>
                    <p class="empty-state-text">HenÃ¼z kayÄ±tlÄ± kullanÄ±cÄ± bulunmuyor.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        const alertContainer = document.getElementById('alertContainer');
        const usersTableBody = document.getElementById('usersTableBody');
        const emptyState = document.getElementById('emptyState');
        const userCountEl = document.getElementById('userCount');
        const logoutBtn = document.getElementById('logoutBtn');

        // Admin kontrolÃ¼
        if (!AuthSystem.isAdminLoggedIn()) {
            window.location.href = 'admin-login.html';
        }

        // Åifre decode (base64)
        function decodePassword(hash) {
            try {
                const decoded = atob(hash);
                return decoded.replace('_secure_salt_2024', '');
            } catch (e) {
                return '***';
            }
        }

        // KullanÄ±cÄ±larÄ± yÃ¼kle
        function loadUsers() {
            const users = AuthSystem.getUsers();

            userCountEl.textContent = users.length;

            if (users.length === 0) {
                usersTableBody.innerHTML = '';
                emptyState.style.display = 'block';
                document.querySelector('.table-container').style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            document.querySelector('.table-container').style.display = 'block';

            usersTableBody.innerHTML = users.map(user => `
                <tr data-user-id="${user.id}">
                    <td class="user-id">${user.id.substring(0, 12)}...</td>
                    <td><strong>${escapeHtml(user.username)}</strong></td>
                    <td class="user-email">${escapeHtml(user.email)}</td>
                    <td class="user-password" style="font-family: monospace; color: #f6ad55;">
                        <span class="password-hidden" id="pwd-${user.id}">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
                        <button class="btn-show-pwd" onclick="togglePassword('${user.id}', '${user.password}')" style="margin-left: 8px; padding: 4px 8px; font-size: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; border-radius: 4px; cursor: pointer;">
                            ğŸ‘ï¸
                        </button>
                    </td>
                    <td class="user-date">${AuthSystem.formatDate(user.createdAt)}</td>
                    <td>
                        <button class="btn-delete" onclick="deleteUser('${user.id}')">
                            ğŸ—‘ï¸ Sil
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Åifre gÃ¶ster/gizle
        function togglePassword(userId, hash) {
            const el = document.getElementById('pwd-' + userId);
            if (el.textContent === 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢') {
                el.textContent = decodePassword(hash);
                el.style.color = '#48bb78';
            } else {
                el.textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
                el.style.color = '#f6ad55';
            }
        }

        // Global functions
        window.togglePassword = togglePassword;

        // HTML escape
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // KullanÄ±cÄ± silme
        function deleteUser(userId) {
            if (confirm('Bu kullanÄ±cÄ±yÄ± silmek istediÄŸinizden emin misiniz?')) {
                const result = AuthSystem.deleteUser(userId);

                if (result.success) {
                    AuthSystem.showAlert(alertContainer, 'success', result.message);

                    // SatÄ±rÄ± animasyonla kaldÄ±r
                    const row = document.querySelector(`tr[data-user-id="${userId}"]`);
                    if (row) {
                        row.style.animation = 'slideUp 0.3s ease-out reverse';
                        setTimeout(() => {
                            loadUsers();
                        }, 300);
                    }
                } else {
                    AuthSystem.showAlert(alertContainer, 'error', result.message);
                }
            }
        }

        // Global function for delete button
        window.deleteUser = deleteUser;

        // Ã‡Ä±kÄ±ÅŸ yap
        logoutBtn.addEventListener('click', function () {
            AuthSystem.adminLogout();
            window.location.href = 'admin-login.html';
        });

        // Sayfa yÃ¼klendiÄŸinde kullanÄ±cÄ±larÄ± getir
        loadUsers();

        // Her 5 saniyede yeni kullanÄ±cÄ±larÄ± kontrol et
        setInterval(loadUsers, 5000);
    </script>
</body>

</html>